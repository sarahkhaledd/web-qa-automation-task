version: 2.1

jobs:
  ui-tests:
    docker:
      - image: cimg/node:18.20-browsers
    steps:
      - checkout
      - run:
          name: Install dependencies
          command: |
            cd nightwatch-project
            npm install
      - run:
          name: Install Google Chrome
          command: |
            sudo apt-get update
            sudo apt-get install -y wget gnupg
            wget -q -O - https://dl.google.com/linux/linux_signing_key.pub | \
              sudo gpg --dearmor -o /usr/share/keyrings/google-linux-signing-key.gpg
            echo "deb [arch=amd64 signed-by=/usr/share/keyrings/google-linux-signing-key.gpg] http://dl.google.com/linux/chrome/deb/ stable main" | \
              sudo tee /etc/apt/sources.list.d/google-chrome.list
            sudo apt-get update
            sudo apt-get install -y google-chrome-stable
      - run:
          name: Run UI tests
          command: |
            cd nightwatch-project
            npx nightwatch --env ci

  api-tests:
    docker:
      - image: cimg/node:18.20
    steps:
      - checkout
      - run:
          name: Install dependencies
          command: |
            cd api-automation
            npm install
      - run:
          name: Start mock API server
          command: |
            cd api-automation
            npm run dev
          background: true
      - run:
          name: Wait for server to start
          command: sleep 5
      - run:
          name: Run API tests
          command: |
            cd api-automation
            npm run test:ci

workflows:
  version: 2
  run-tests:
    jobs:
      - ui-tests
      - api-tests